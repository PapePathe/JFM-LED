<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for players or teams..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>

<div class="card-container">
  <table class="table table-hover hidden-xs">
    <thead>
      <h4 class="hidden-xs"><strong>Liste de vos interventions</strong></h4>
      <tr>
        <th scope="col">Numéro d'affaire</th>
        <th scope="col">Commandé le</th>
        <th scope="col">Entreprise</th>
        <th scope="col">Client</th>
        <th scope="col">Adresse</th>
        <th scope="col">Durée</th>
        <th scope="col">Date</th>
        <th scope="col">BdC</th>
        <th class="text-center" scope="col">PV</th>
        <th scope="col">Détails</th>
      </tr>
    </thead>
    <tbody>
      <% unless bookings.nil? %>
        <% bookings.each do |booking| %>
          <tr>
            <th scope="row">#<%= booking.reference %></th>
            <td><%= booking.created_at.strftime("%d/%m/%y") %></td>
            <td><%= booking.user.company.name %></td>
            <td><%= booking.user.first_name + ' ' + booking.user.last_name %></td>
            <td><%= booking.address.full_address %></td>
            <td><%= booking.availabilities.size.odd? ? "#{booking.availabilities.size} ½j" : "#{booking.availabilities.size / 2} j" %></td>
            <td>
              <% if @user.manager? && booking.availabilities.first.pending? %>
                <%= link_to "Valider dates", manager_planning_path %>
              <% else %>
                <% booking.availabilities.map do |availability| availability.date end.uniq.sort.each do |date| %>
                  <p><%= date.strftime("%d/%m/%y") %></p>
                <% end %>
              <% end %>
            </td>
            <td>
              <% if booking.pdf? %>
                <%= link_to(content_tag(:i, nil, class: 'fa card-icon fa-file-text-o'), cloudinary_url(booking.pdf.path), target: :_blank) %>
              <% else %>
                <i class="fa card-icon fa-file-text-o" style="color: gray"></i>
              <% end %>
            </td>
            <td>
              <% if booking.report.signed? %>
                <%= link_to(content_tag(:i, nil, class: 'fa fa-eye card-icon'), [@user.role, booking.report])%>
                <%= link_to(content_tag(:i, nil, class: 'fa fa-file-pdf-o card-icon'), [@user.role, booking.report, format: :pdf, target: :_blank])%>
              <% elsif booking.report.progress > 0 %>
                <%= booking.report.progress %> %
              <% else %>
                <i class="fa fa-eye card-icon" style="color: gray"></i>
                <i class="fa fa-file-pdf-o card-icon" style="color: gray"></i>
              <% end %>
            </td>
            <td><%= link_to [@user.role, booking] do %>
                <i class="fa card-icon fa-eye"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <table class="table table-hover hidden-sm hidden-md hidden-lg hidden-xl">
    <thead>
      <h4 class="hidden-sm hidden-md hidden-lg hidden-xl"><strong>Liste de vos interventions</strong></h4>
        <tr>
          <th scope="col">Affaire</th>
          <th scope="col">Infos</th>
          <th scope="col">Détails</th>
        </tr>
    </thead>
    <tbody>
      <% unless bookings.nil? %>
        <% bookings.each do |booking| %>
          <tr>
            <td><strong><%= booking.user.company.name %></strong> <br> <%= booking.reference %> <br> <%= booking.created_at.strftime("%d/%m/%y") %> </td>
            <td><%= booking.product.label %> <br> <%= booking.city %></td>
            <td class='text-center'><%= link_to [@user.role, booking] do %>
                <i class="fa fa-eye"></i>
              <% end %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>

<%= content_for :after_js do %>
  <script>
    var client = algoliasearch('W7HIKRIOMJ', 'e73aab21c2b35cb58b90872399fbee59');
    var index = client.initIndex('Booking', 'Company');
    //initialize autocomplete on search input (ID selector must match)
    autocomplete('#aa-search-input',
    { hint: false }, {
        source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
        //value to be displayed in input control after user's suggestion selection
        displayKey: 'booking',
        //hash of templates used when rendering dataset
        templates: {
            //'suggestion' templating function used to render a single suggestion
            suggestion: function(suggestion) {
              return '<span><img src="'
                      + suggestion.company.logo
                      + '"></span><span>'
                      + '<p><strong>'
                      + suggestion._highlightResult.company.company.value + '</strong> ' + suggestion._highlightResult.user.first_name.value + ' ' + suggestion._highlightResult.user.last_name.value
                      + '</p><i style="font-weight: lighter">' + suggestion._highlightResult.product.label.value + '</i></span>';
            }
        }
    }).on('autocomplete:selected', function(event, suggestion, dataset) {
    location.href = 'bookings/' + suggestion.id;
  });;
  </script>
<% end %>
